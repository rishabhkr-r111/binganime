<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="description" content="Anime Template" />
    <meta name="keywords" content="Anime, unica, creative, html" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Binganime</title>
    <!-- Google Font -->
    <link
      href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />
    <!-- Css Styles -->
    <link rel="stylesheet" href="/css/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="/css/font-awesome.min.css" type="text/css" />
    <link rel="stylesheet" href="/css/elegant-icons.css" type="text/css" />
    <link rel="stylesheet" href="/css/slicknav.min.css" type="text/css" />
    <link rel="stylesheet" href="/css/style.css" type="text/css" />
    <style>
      .slicknav_nav a {
        color: #ffffff;
      }

      .slicknav_nav a:hover {
        color: #ffffff;
      }
      .filter__controls li a {
        color: #ffffff;
        border: 1px solid white;
        border-radius: 10%;
        padding: 3px;
      }
      .filter__controls li a.current {
        color: #000;
        background: #ffffff;
      }
      .search-icon {
        width: 50px;
        height: 50px;
        font-size: 40px;
      }
      .search-model-form {
        display: flex;
        text-align: center;
      }
      .product__sidebar__comment__item {
        border: 1px solid #ffffff;
        border-radius: 5px;
      }
      .product__sidebar__comment__item__text h5 {
        margin-top: 10px;
      }
      .product__sidebar__comment__item__pic {
        width: 90px;
        height: auto;
      }
      .more {
        display: none;
      }
      .iframe {
      margin: auto;

      }
    .iframe iframe {
      width: 110%;
      height: 260px;
      transform: translateX(-5%)
     }
    select{
      background: rgb(220,53,69);
      color: #ffffff;
      border: none;
      padding: 10px;
      margin: auto;
      margin-bottom: 10px;
      border-radius: 4px;

    }
    a.current{
      background: #ffffff;
      color: #000;
    }

    </style>
  </head>
  <body>
    <%- include('./partials/header.ejs') %>

<section class="anime-details spad">
    <div class="container">
      <div class="anime__details__content">
       
        <div class="row">
        
          <div class="section-title ml-2">
            <h5><%= title %></h5>
          </div>
        </div>
        <div class="row ">
          <select onchange="selectServer()">
          <% for(i=0 ; i<links.length ; i++) { 
            let key = Object.keys(links[i]);
            let value = Object.values(links[i]);
            %>
          <option value="<%= value %>" ><%= key  %></option>

            <% } %>
          </select>
          
        </div>
       
         <div class="row">
          <div class="iframe">
            <iframe src="<%= Object.values(links[0]) %>" allowfullscreen="true" frameborder="0" marginwidth="0" marginheight="0" scrolling="no" width="100%" height="100%"></iframe>
          </div>
       
         </div>
         <div class="row">
           <div class="mx-auto text-white" style="display : flex">

            <% if (current_ep > 1) {  %>             
            <div class="mx-4 mt-2 text-white"><a href="<%= eps[eps.length-current_ep+1].slug%>">< Epsoide <%=current_ep-1%></a></div>

           <% } %>
              <button class="btn btn-danger mx-auto mb-4" onclick="download()">Download</button>

            <% if (current_ep < eps.length) { %>
            <div class="mx-4 mt-2 text-white"><a href="<%=eps[eps.length -current_ep-1].slug%>"> Epsoide <%= parseInt(current_ep)+1 %> > </a></div>

            <% } %>
          </div>
          <div class="col-lg-9">
           
            <div class="anime__details__text">
              
              
              <div class="anime__details__widget">
                <div class="row">
                  <div class="col-lg-12 col-md-12">
                    <ul class="anime-attributes">
                      <li><span>Watching:</span><%= title %> episode <%= current_ep %><a href="/details/<%= slug %>"> (all episodes)</a></li>
                      <li><span>Description</span><%= details %></li>
                      <li class="status"><span>Status:</span> </li>
                      <li class="type"><span>Type:</span></li>
                      
                      <li class="duration"><span>Duration :</span> </li>
                      <li class="genres"><span>Genres:</span> </li>
                    
                      <div class="more">
                      <li class="openings"><span>Openings :</span>
                      <ul class="text-white">
         
                      </ul>
                      </li>
                      <li class="endings"><span>Endings :</span>
                      <ul class="text-white">
                        
                      </ul>
                      </li>
                      <li class="related-content"><span>Related Content : </span></li>
 
                      
                      </div>
                       <h5 class="text-white text-center more-text"> show more... </h5>
                    </ul>
                  </div>
                </div>
                <div class="anime__details__episodes ">

                <!--
                  <div class="section-title ">
                    <h5>Related Episodes</h5>
                  </div>
                  <div class="episodes-list">
                  <a href="#">Episode 010</a>
                  <a href="#">Episode 020</a>
                  <a href="#">Episode 030</a>
                  <a href="#">Episode 0400</a>
                  <a href="#" class="current">Episode 05</a>
                  <a href="#">Episode 06</a>
                  <a href="#">Episode 07</a>
                  <a href="#">Episode 08</a>
                  <a href="#">Episode 09</a>
                  
                </div>
                --!>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

    <%- include('./partials/footer.ejs') %>

    <!-- Search model Begin -->
    <div class="search-model">
      <div class="h-100 d-flex align-items-center justify-content-center">
        <div class="search-close-switch"><i class="icon_close"></i></div>
        <form class="search-model-form">
          <input type="text" id="search-input" placeholder="Search here....." />
          <div class="search-icon">
            <i class="fa fa-search" aria-hidden="true"></i>
          </div>
        </form>
      </div>
    </div>
    <!-- Search model end -->
    <!-- Js Plugins -->
    <script src="/js/jquery-3.3.1.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/jquery.slicknav.js"></script>
    <script src="/js/main.js"></script>
    <script>
      let more = false;
      
      function download() {
              
              let durl = "<%= links.map( link => {
                      if(Object.keys(link) == 'Multi quality') { return Object.values(link) } else { return null } }) %>"
                if(durl == null ){
                        alert('Download Link not found for this episode')
                        return 
                      }

              window.open(durl.replace('loadserver.php','download'))
              
      }
      function selectServer() {
      let selectedLink = $('select').val()
      let src = $('iframe').attr('src',selectedLink)
    }
      (async function getDetails() {
              let r =  await fetch(`https://api.jikan.moe/v3/search/anime?q=<%= title %>`)
      let json = await r.json()
      r = await fetch(`https://api.jikan.moe/v3/anime/${json.results[0].mal_id}`)
      let data = await r.json()
      
      let info = {
        alias_en : data.title_english,
        alias_jp : data.title_japanese,
        image_url :data.image_url ,
        status : data.status,
        genres : generateGeneres(data.genres),
        type : data.type,
        openings : data.opening_themes,
        endings : data.ending_themes,
        duration : data.duration,
        my_anime_list : data.url
      }
      
      putContent(info)
    })()
    
    function generateGeneres(data) {
      generes = []
      data.map( genere => {
        generes.push(genere.name)
      })
      return generes.join(', ')
    }
      function putContent(info) {
        $('.anime__details__title span').text('( ' + info.alias_jp + ' / ' + info.alias_en + ' )')
      $('.set-bg').css('background-image', 'url(' + info.image_url + ')')
      $('.anime-attributes .genres').html('<span> Genres : </span>' + info.genres)
      $('.anime-attributes .status').html('<span> Status : </span>' + info.status)
      $('.anime-attributes .duration').html('<span> Duration : </span>' + info.duration)
      $('.anime-attributes .type').html('<span> Type : </span>' + info.type)
      $('.related-content').html('<span> Related : </span>' + `<a href="${info.my_anime_list}" target="_blank" rel="noopener noreferrer" >MyAnimelist</a>`)


      info.openings.map(op => {
              $('.openings ul').prepend(`<li><a href="https://m.youtube.com/results?search_query=<%= title %> openings ${op.split('"')[1]}" target="_blank" rel="noopener noreferrer"> ${op}</a> </li>`)
      })
      info.endings.map(end => {
              $('.endings ul').prepend(`<li> <a href="https://m.youtube.com/results?search_query=<%= title %> ending ${end.split('"')[1]}" target="_blank" rel="noopener noreferrer"> ${end}</a> </li>`)
      })

      $('.more-text').on('click', function () {
        if(!more){
          $('.more').css('display','inline')
          $(this).text('show less')
          more = true
        }
        else {
          $('.more').css('display','none')
          $(this).text('show more...')
          more = false
        }
      })
      }

    </script>
  </body>
</html>
